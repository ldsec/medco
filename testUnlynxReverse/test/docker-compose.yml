version: '2.4'
services:
  medco-unlynx-srv0:
    extends:
      file: ../docker-compose-definitions.yml
      service: medco-unlynx
    ports:
      - "2000:2000"
      - "2001:2001"
    environment:
      - MEDCO_NODE_IDX=0
    networks:
      intra-node-srv0:
      inter-nodes:
        ipv4_address: 172.31.1.101
    volumes:
      - ./configuration:/medco-configuration

  medco-unlynx-srv1:
    extends:
      file: ../docker-compose-definitions.yml
      service: medco-unlynx
    ports:
      - "2002:2002"
      - "2003:2003"
    environment:
      - MEDCO_NODE_IDX=1
    networks:
      intra-node-srv1:
      inter-nodes:
        ipv4_address: 172.31.1.111
    volumes:
      - ./configuration:/medco-configuration


  medco-client-srv0:
    extends:
      file: ../docker-compose-definitions.yml
      service: medco-client
    ports:
        - "2004:2000"
        - "2005:2001"
    environment:
      - MEDCO_NODE_IDX=2
    networks:
      intra-node-srv2:
      inter-nodes:
        ipv4_address: 172.31.1.121
    volumes:
      - ./configuration:/medco-configuration

  #nginx-srv0:
  #  extends:
  #    file: ../docker-compose-definitions.yml
  #    service: nginx
  #  ports:
  #    - "2010:2010"
  #    - "2011:2011"
  #  networks:
  #    intra-node-srv0:
  #    inter-nodes:
  #      ipv4_address: 172.31.1.200

  #nginx-srv1:
  #    extends:
  #      file: ../docker-compose-definitions.yml
  #      service: nginx
  #    ports:
  #      - "2012:2012"
  #      - "2013:2013"
  #    networks:
  #      intra-node-srv1:
  #      inter-nodes:
  #        ipv4_address: 172.31.1.220


networks:
  inter-nodes:
    driver: bridge
    ipam:
      config:
        - subnet: 172.31.1.0/24

  intra-node-srv0:
    driver: bridge
  intra-node-srv1:
    driver: bridge
  intra-node-srv2:
    driver: bridge